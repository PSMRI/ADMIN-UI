<div class="container-fluid">
  <!-- TABLE MODE - Listing Page -->
  <div class="row" *ngIf="tableMode">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      <h4>
        <strong>Facility Hierarchy</strong>
      </h4>
    </div>

    <!-- In-Table Search -->
    <div
      class=""
      style="text-align: end"
      *ngIf="facilityList.length > 0"
    >
      <mat-form-field id="filterbox">
        <mat-label>In-Table Search</mat-label>
        <input
          matInput
          name="filterTerm"
          [(ngModel)]="filterTerm"
          #filterTermInput
          (keyup)="filterFacilityList(filterTermInput.value)"
        />
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
    </div>

    <!-- Facility Table -->
    <div class="col-xs-12 col-sm-12">
      <div class="table-responsive">
        <table
          mat-table
          [dataSource]="filteredFacilityList"
          *ngIf="facilityList.length > 0"
          class="table table-striped table-hover"
        >
          <!-- S.No. Column -->
          <ng-container matColumnDef="sno">
            <th mat-header-cell *matHeaderCellDef>S.No.</th>
            <td mat-cell *matCellDef="let item; let i = index">
              {{ i + 1 }}
            </td>
          </ng-container>

          <!-- Facility Type Column -->
          <ng-container matColumnDef="facilityType">
            <th mat-header-cell *matHeaderCellDef>Facility Type</th>
            <td mat-cell *matCellDef="let item">{{ item.facilityType }}</td>
          </ng-container>

          <!-- Facility Name Column -->
          <ng-container matColumnDef="facilityName">
            <th mat-header-cell *matHeaderCellDef>Facility Name</th>
            <td mat-cell *matCellDef="let item">{{ item.facilityName }}</td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let item; let i = index">
              <button
                mat-icon-button
                matTooltip="View"
                (click)="showViewMode(item, i)"
                style="border: unset; background-color: unset"
              >
                <mat-icon>visibility</mat-icon>
              </button>
              <button
                mat-icon-button
                matTooltip="Edit"
                (click)="showEditMode(item, i)"
                style="border: unset; background-color: unset"
              >
                <mat-icon>edit</mat-icon>
              </button>
            </td>
          </ng-container>

          <!-- Header and Row Definitions -->
          <tr
            mat-header-row
            *matHeaderRowDef="displayedColumns"
          ></tr>
          <tr
            mat-row
            *matRowDef="let row; columns: displayedColumns"
          ></tr>
        </table>

        <!-- No Records -->
        <div
          *ngIf="facilityList.length === 0"
          style="text-align: center; font-size: 16px; padding: 20px"
        >
          <strong>No records found</strong>
        </div>

        <!-- Pagination -->
        <mat-paginator
          [hidden]="filteredFacilityList.data.length === 0"
          [pageSizeOptions]="[5, 10, 25]"
          [pageSize]="5"
          showFirstLastButtons
        ></mat-paginator>

        <!-- Add Facility Button -->
        <div style="padding: 10px 0">
          <button
            mat-raised-button
            color="primary"
            class="pull-right mat_blue"
            (click)="showForm()"
          >
            Add Facility
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- FORM MODE - Add Facility Page -->
  <div class="row" *ngIf="formMode">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      <h4>
        <strong>Add Facility</strong>
      </h4>
    </div>
    <div class="col-12 p-a-0">
      <form [formGroup]="facilityForm" class="row" style="width: 100%; margin-left: 0px">
        <!-- State -->
        <div class="col-3">
          <mat-form-field [style.width]="'100%'" class="hide_underline">
            <mat-label>State</mat-label>
            <mat-select
              formControlName="state"
              (selectionChange)="onStateChange()"
            >
              <mat-option *ngFor="let state of states" [value]="state">
                {{ state.stateName }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- District -->
        <div class="col-3">
          <mat-form-field [style.width]="'100%'" class="hide_underline">
            <mat-label>District</mat-label>
            <mat-select
              formControlName="district"
              (selectionChange)="onDistrictChange()"
            >
              <mat-option *ngFor="let district of districts" [value]="district">
                {{ district.districtName }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Taluk -->
        <div class="col-3">
          <mat-form-field [style.width]="'100%'" class="hide_underline">
            <mat-label>Taluk</mat-label>
            <mat-select formControlName="taluk">
              <mat-option *ngFor="let taluk of taluks" [value]="taluk">
                {{ taluk.blockName }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Facility Type -->
        <div class="col-3">
          <mat-form-field [style.width]="'100%'" class="hide_underline">
            <mat-label>Facility Type</mat-label>
            <mat-select formControlName="facilityType">
              <mat-option *ngFor="let type of facilityTypes" [value]="type">
                {{ type }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Facility Name -->
        <div class="col-3">
          <mat-form-field [style.width]="'100%'">
            <mat-label>Facility Name</mat-label>
            <input
              matInput
              formControlName="facilityName"
              maxlength="100"
            />
          </mat-form-field>
        </div>

        <!-- Urban / Rural Radio -->
        <div class="col-3 m-t-10">
          <mat-radio-group formControlName="areaType">
            <mat-radio-button value="Urban" class="m-r-10">Urban</mat-radio-button>
            <mat-radio-button value="Rural">Rural</mat-radio-button>
          </mat-radio-group>
        </div>
      </form>
    </div>

    <!-- Buttons -->
    <div class="col-xs-12 col-sm-12 m-t-15" style="padding-bottom: 40px">
      <button
        mat-raised-button
        color="primary"
        class="pull-left mat_blue"
        (click)="showTable()"
      >
        Back
      </button>
      <button
        mat-raised-button
        color="accent"
        class="pull-right mat_green"
        type="submit"
        [disabled]="facilityForm.invalid"
        (click)="saveFacility()"
      >
        Save
      </button>
    </div>
  </div>

  <!-- VIEW MODE - Read-only -->
  <div class="row" *ngIf="viewMode">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      <h4>
        <strong>View Facility</strong>
      </h4>
    </div>
    <div class="col-12 p-a-0">
      <form [formGroup]="facilityForm" class="row" style="width: 100%; margin-left: 0px">
        <!-- State -->
        <div class="col-3">
          <mat-form-field [style.width]="'100%'" class="hide_underline">
            <mat-label>State</mat-label>
            <mat-select formControlName="state">
              <mat-option *ngFor="let state of states" [value]="state">
                {{ state.stateName }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- District -->
        <div class="col-3">
          <mat-form-field [style.width]="'100%'" class="hide_underline">
            <mat-label>District</mat-label>
            <mat-select formControlName="district">
              <mat-option *ngFor="let district of districts" [value]="district">
                {{ district.districtName }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Taluk -->
        <div class="col-3">
          <mat-form-field [style.width]="'100%'" class="hide_underline">
            <mat-label>Taluk</mat-label>
            <mat-select formControlName="taluk">
              <mat-option *ngFor="let taluk of taluks" [value]="taluk">
                {{ taluk.blockName }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Facility Type -->
        <div class="col-3">
          <mat-form-field [style.width]="'100%'" class="hide_underline">
            <mat-label>Facility Type</mat-label>
            <mat-select formControlName="facilityType">
              <mat-option *ngFor="let type of facilityTypes" [value]="type">
                {{ type }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Facility Name -->
        <div class="col-3">
          <mat-form-field [style.width]="'100%'">
            <mat-label>Facility Name</mat-label>
            <input
              matInput
              formControlName="facilityName"
            />
          </mat-form-field>
        </div>

        <!-- Urban / Rural Radio -->
        <div class="col-3 m-t-10">
          <mat-radio-group formControlName="areaType">
            <mat-radio-button value="Urban" class="m-r-10">Urban</mat-radio-button>
            <mat-radio-button value="Rural">Rural</mat-radio-button>
          </mat-radio-group>
        </div>
      </form>
    </div>

    <!-- Back Button -->
    <div class="col-xs-12 col-sm-12 m-t-15" style="padding-bottom: 40px">
      <button
        mat-raised-button
        color="primary"
        class="pull-left mat_blue"
        (click)="showTable()"
      >
        Back
      </button>
    </div>
  </div>

  <!-- EDIT MODE -->
  <div class="row" *ngIf="editMode">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      <h4>
        <strong>Edit Facility</strong>
      </h4>
    </div>
    <div class="col-12 p-a-0">
      <form [formGroup]="facilityForm" class="row" style="width: 100%; margin-left: 0px">
        <!-- State -->
        <div class="col-3">
          <mat-form-field [style.width]="'100%'" class="hide_underline">
            <mat-label>State</mat-label>
            <mat-select
              formControlName="state"
              (selectionChange)="onStateChange()"
            >
              <mat-option *ngFor="let state of states" [value]="state">
                {{ state.stateName }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- District -->
        <div class="col-3">
          <mat-form-field [style.width]="'100%'" class="hide_underline">
            <mat-label>District</mat-label>
            <mat-select
              formControlName="district"
              (selectionChange)="onDistrictChange()"
            >
              <mat-option *ngFor="let district of districts" [value]="district">
                {{ district.districtName }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Taluk -->
        <div class="col-3">
          <mat-form-field [style.width]="'100%'" class="hide_underline">
            <mat-label>Taluk</mat-label>
            <mat-select formControlName="taluk">
              <mat-option *ngFor="let taluk of taluks" [value]="taluk">
                {{ taluk.blockName }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Facility Type -->
        <div class="col-3">
          <mat-form-field [style.width]="'100%'" class="hide_underline">
            <mat-label>Facility Type</mat-label>
            <mat-select formControlName="facilityType">
              <mat-option *ngFor="let type of facilityTypes" [value]="type">
                {{ type }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Facility Name -->
        <div class="col-3">
          <mat-form-field [style.width]="'100%'">
            <mat-label>Facility Name</mat-label>
            <input
              matInput
              formControlName="facilityName"
              maxlength="100"
            />
          </mat-form-field>
        </div>

        <!-- Urban / Rural Radio -->
        <div class="col-3 m-t-10">
          <mat-radio-group formControlName="areaType">
            <mat-radio-button value="Urban" class="m-r-10">Urban</mat-radio-button>
            <mat-radio-button value="Rural">Rural</mat-radio-button>
          </mat-radio-group>
        </div>
      </form>
    </div>

    <!-- Buttons -->
    <div class="col-xs-12 col-sm-12 m-t-15" style="padding-bottom: 40px">
      <button
        mat-raised-button
        color="primary"
        class="pull-left mat_blue"
        (click)="showTable()"
      >
        Back
      </button>
      <button
        mat-raised-button
        color="accent"
        class="pull-right mat_green"
        [disabled]="facilityForm.invalid"
        (click)="updateFacility()"
      >
        Update
      </button>
    </div>
  </div>
</div>
