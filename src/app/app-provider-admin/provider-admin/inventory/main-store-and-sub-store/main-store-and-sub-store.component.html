<div class="row" *ngIf="tableMode">
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    <h4>
      <strong>Main Store & Sub Store</strong>
    </h4>
  </div>
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 p-a-0">
    <form id="form" #storeSearchForm="ngForm" autocomplete="off">
      <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
        <mat-form-field class="hide_underline" [style.width]="'100%'">
          <input matInput style="display: none" />
          <mat-select
            required
            name="Services"
            placeholder="Serviceline"
            [style.width]="'100%'"
            [(ngModel)]="serviceline"
            (selectionChange)="getstates(serviceline)"
          >
            <mat-option *ngFor="let item of services_array" [value]="item">
              {{ item.serviceName }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
        <mat-form-field class="hide_underline" [style.width]="'100%'">
          <input matInput style="display: none" />
          <mat-select
            required
            name="state"
            placeholder="State"
            [style.width]="'100%'"
            [(ngModel)]="state"
          >
            <mat-option
              *ngFor="let item of states_array"
              [value]="item"
              (click)="getAllStores(item.providerServiceMapID)"
            >
              {{ item.stateName }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div
        class="col-xs-12 col-sm-12 col-md-4 col-lg-6"
        *ngIf="tableMode && providerServiceMapID"
      >
        <div class="row" *ngIf="storesList?.length > 0" class="pull-right">
          <mat-form-field id="filterbox">
            <input
              matInput
              placeholder="In-Table Search"
              name="filterTerm"
              [(ngModel)]="create_filterTerm"
              #filterTerm
              (keyup)="filterstoreList(filterTerm.value)"
            />
            <mat-icon matSuffix>search</mat-icon>
          </mat-form-field>
        </div>
      </div>
    </form>
  </div>
  <!-- pre-populated table showing the number of providers available -->
  <div class="col-xs-12 col-sm-12">
    <div class="">
      <mat-table
        [dataSource]="filteredstoresList"
        *ngIf="showTableFlag"
        class="table table-striped table-hover"
      >
        <!-- S.No. Column -->
        <ng-container matColumnDef="sno">
          <mat-header-cell *matHeaderCellDef>S.No.</mat-header-cell>
          <mat-cell *matCellDef="let item; let i = index">{{ i + 1 }}</mat-cell>
        </ng-container>

        <!-- Category Code Column -->
        <ng-container matColumnDef="facilityName">
          <mat-header-cell *matHeaderCellDef>Facility Name</mat-header-cell>
          <mat-cell *matCellDef="let item">{{ item.facilityName }}</mat-cell>
        </ng-container>

        <!-- Category Name Column -->
        <ng-container matColumnDef="facilityCode">
          <mat-header-cell *matHeaderCellDef>Facility Code</mat-header-cell>
          <mat-cell *matCellDef="let item">{{ item.facilityCode }}</mat-cell>
        </ng-container>

        <!-- Category Description Column -->
        <ng-container matColumnDef="facilityDesc">
          <mat-header-cell *matHeaderCellDef
            >Facility Description</mat-header-cell
          >
          <mat-cell *matCellDef="let item">{{ item.facilityDesc }}</mat-cell>
        </ng-container>

        <ng-container matColumnDef="location">
          <mat-header-cell *matHeaderCellDef>Location</mat-header-cell>
          <mat-cell *matCellDef="let item">{{ item.location }}</mat-cell>
        </ng-container>

        <ng-container matColumnDef="physicalLocation">
          <mat-header-cell *matHeaderCellDef>Physical Location</mat-header-cell>
          <mat-cell *matCellDef="let item">{{
            item.physicalLocation
          }}</mat-cell>
        </ng-container>

        <ng-container matColumnDef="storeType">
          <mat-header-cell *matHeaderCellDef>Store Type</mat-header-cell>
          <mat-cell *matCellDef="let item">{{ item.storeType }}</mat-cell>
        </ng-container>

        <!-- Edit Column -->
        <ng-container matColumnDef="edit">
          <mat-header-cell *matHeaderCellDef>Edit</mat-header-cell>
          <mat-cell *matCellDef="let item">
            <mat-icon
              mdTooltip="Edit"
              class="mat-icon material-icons"
              role="img"
              aria-hidden="true"
              style="cursor: pointer"
              *ngIf="!item.deleted"
              (click)="editFacility(item)"
              >edit</mat-icon
            >
          </mat-cell>
        </ng-container>

        <!-- Action Column -->
        <ng-container matColumnDef="action">
          <mat-header-cell *matHeaderCellDef>Action</mat-header-cell>
          <mat-cell *matCellDef="let item">
            <button
              mat-raised-button
              color="accent"
              *ngIf="item.deleted"
              class="m-r-10 mat_green"
              (click)="activateDeactivate(item.facilityID, false)"
            >
              Activate
            </button>
            <button
              mat-raised-button
              color="primary"
              *ngIf="!item.deleted"
              class="m-r-10 mat_blue"
              (click)="activateDeactivate(item.facilityID, true)"
            >
              Deactivate
            </button>
          </mat-cell>
        </ng-container>
        <mat-header-row
          *matHeaderRowDef="[
            'sno',
            'facilityName',
            'facilityCode',
            'facilityDesc',
            'location',
            'physicalLocation',
            'storeType',
            'edit',
            'action'
          ]"
        ></mat-header-row>
        <mat-row
          *matRowDef="
            let row;
            columns: [
              'sno',
              'facilityName',
              'facilityCode',
              'facilityDesc',
              'location',
              'physicalLocation',
              'storeType',
              'edit',
              'action'
            ]
          "
        ></mat-row>
      </mat-table>
      <div>
        <button
          mat-raised-button
          color="primary"
          *ngIf="createButton"
          class="pull-right mat_blue"
          (click)="showForm()"
        >
          Create Store
        </button>
      </div>
      <!-- Pagination -->
      <div
        *ngIf="
          filteredstoresList &&
          filteredstoresList.data.length === 0 &&
          showTableFlag
        "
        style="text-align: center; font-size: 16px"
      >
        <strong>No records found</strong>
      </div>
      <mat-paginator
        [hidden]="filteredstoresList.data.length === 0"
        [pageSizeOptions]="[5, 10, 25]"
        [pageSize]="5"
        showFirstLastButtons
      ></mat-paginator>
    </div>
  </div>
</div>
<div class="row" *ngIf="formMode">
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    <h4>
      <strong>Main Store & Sub Store</strong>
    </h4>
  </div>
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 p-a-0">
    <form id="addform" #storeAddForm1="ngForm" autocomplete="off">
      <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
        <mat-form-field class="hide_underline" [style.width]="'100%'">
          <input matInput style="display: none" />
          <mat-select
            required
            name="Services"
            placeholder="Serviceline"
            [disabled]="true"
            [style.width]="'100%'"
            [(ngModel)]="serviceline"
            (change)="getstates(serviceline)"
          >
            <mat-option *ngFor="let item of services_array" [value]="item">
              {{ item.serviceName }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
        <mat-form-field class="hide_underline" [style.width]="'100%'">
          <input matInput style="display: none" />
          <mat-select
            required
            name="state"
            placeholder="State"
            [style.width]="'100%'"
            [disabled]="true"
            [(ngModel)]="state"
          >
            <mat-option *ngFor="let item of states_array" [value]="item">
              {{ item.stateName }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </form>

    <div class="clearfix visible-lg"></div>

    <form id="inputform" #storeAddForm="ngForm" autocomplete="off">
      <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3 m-t--25">
        <mat-form-field class="hide_underline" [style.width]="'100%'">
          <input matInput style="display: none" />
          <mat-select
            required
            name="facilityType"
            placeholder="Facility Type"
            [style.width]="'100%'"
            [(ngModel)]="create_facilityType"
          >
            <mat-option *ngFor="let item of facilityType_array" [value]="item">
              {{ item.facilityTypeName }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
        <mat-form-field [style.width]="'100%'">
          <input
            matInput
            required
            placeholder="Facility Code"
            (blur)="checkExistance(create_facilityCode)"
            appPanWithCopyPaste
            [(ngModel)]="create_facilityCode"
            maxlength="15"
            name="facilityCode"
            #facilityTypeCode="ngModel"
          />
          <mat-hint>
            <span
              class="error_text"
              *ngIf="
                !facilityTypeCode.valid &&
                (facilityTypeCode.dirty || facilityTypeCode.touched)
              "
              >Facility Code is required</span
            >
            <span
              class="error_text"
              *ngIf="facilityTypeCode.valid && FacilityCodeExist"
              >Facility Code already exists</span
            >
          </mat-hint>
        </mat-form-field>
      </div>
      <div class="clearfix visible-sm"></div>
      <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
        <mat-form-field [style.width]="'100%'">
          <input
            matInput
            required
            placeholder="Facility Name"
            appvehicleNoSpecialCharWithCopyPaste
            [(ngModel)]="create_facilityName"
            maxlength="100"
            name="facilityName"
            #facilityTypeName="ngModel"
          />
          <mat-hint>
            <span
              class="error_text"
              *ngIf="
                !facilityTypeName.valid &&
                (facilityTypeName.dirty || facilityTypeName.touched)
              "
              >Facility Name is required</span
            >
          </mat-hint>
        </mat-form-field>
      </div>
      <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
        <mat-form-field [style.width]="'100%'">
          <input
            matInput
            placeholder="Facility Description"
            appvehicleNoCopyPaste
            [(ngModel)]="create_facilityDiscription"
            maxlength="100"
            name="facilityDescription"
          />
        </mat-form-field>
      </div>
      <div class="clearfix visible-lg"></div>
      <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
        <mat-form-field [style.width]="'100%'">
          <input
            matInput
            placeholder="Location"
            appvehicleNoCopyPaste
            [(ngModel)]="create_location"
            maxlength="100"
            name="createlocation"
            #location="ngModel"
          />
          <mat-hint>
            <span
              class="error_text"
              *ngIf="!location.valid && (location.dirty || location.touched)"
              >Please enter location</span
            >
          </mat-hint>
        </mat-form-field>
      </div>
      <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
        <mat-form-field [style.width]="'100%'">
          <input
            matInput
            placeholder="Physical Location"
            appvehicleNoCopyPaste
            [(ngModel)]="create_physicalLocation"
            maxlength="100"
            name="physicalLocation"
            #physicalLocation="ngModel"
          />
        </mat-form-field>
      </div>
      <div class="clearfix visible-sm"></div>
      <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3 m-t-20">
        <span class="f-s-n-b">Store Type</span>
        <mat-radio-group required>
          <mat-radio-button
            color="primary"
            class="p-l-10"
            [checked]="create_Main_Store_radiobutton"
            (change)="disbleDropdown(true)"
            [value]="true"
            >Main Store</mat-radio-button
          >
          <mat-radio-button
            color="primary"
            class="p-l-10"
            [checked]="create_Sub_Store_radiobutton"
            (change)="disbleDropdown(false)"
            [value]="false"
            >Sub Store</mat-radio-button
          >
        </mat-radio-group>
      </div>

      <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3 m-t--25">
        <mat-form-field class="hide_underline" [style.width]="'100%'">
          <input matInput style="display: none" />
          <mat-select
            name="store"
            [required]="!mainStoreDropdownState"
            [disabled]="mainStoreDropdownState"
            placeholder="Main Store"
            [style.width]="'100%'"
            [(ngModel)]="create_store"
          >
            <mat-option
              *ngFor="let item of storeType_array"
              [value]="item.facilityID"
            >
              {{ item.facilityName }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="col-xs-12 col-sm-6 col-md-4 col-lg-12 m-t-10">
        <button
          mat-mini-fab
          class="xs-pull-right sm-pull-right md-pull-left lg-pull-right mat_blue"
          *ngIf="!editMode && storeAddForm.valid"
          color="primary"
          (click)="
            add2bufferArray(storeAddForm.value); this.storeAddForm.reset()
          "
        >
          <mat-icon
            matSuffix
            class="mat-icon material-icons"
            role="img"
            aria-hidden="true"
            style="cursor: pointer"
            >add</mat-icon
          >
        </button>
      </div>
    </form>
  </div>
  <div class="col-xs-12 col-sm-12 m-t-15" *ngIf="bufferArray.data.length > 0">
    <div class="">
      <mat-table
        [dataSource]="bufferArray"
        class="table table-striped table-hover"
      >
        <!-- S.No. Column -->
        <ng-container matColumnDef="sno">
          <mat-header-cell *matHeaderCellDef>S.No.</mat-header-cell>
          <mat-cell *matCellDef="let item; let i = index">{{ i + 1 }}</mat-cell>
        </ng-container>

        <ng-container matColumnDef="facilityType">
          <mat-header-cell *matHeaderCellDef>Facility Type</mat-header-cell>
          <mat-cell *matCellDef="let item">{{ item.facilityType }}</mat-cell>
        </ng-container>

        <!-- Category Code Column -->
        <ng-container matColumnDef="facilityName">
          <mat-header-cell *matHeaderCellDef>Facility Name</mat-header-cell>
          <mat-cell *matCellDef="let item">{{ item.facilityName }}</mat-cell>
        </ng-container>

        <!-- Category Name Column -->
        <ng-container matColumnDef="facilityCode">
          <mat-header-cell *matHeaderCellDef>Facility Code</mat-header-cell>
          <mat-cell *matCellDef="let item">{{ item.facilityCode }}</mat-cell>
        </ng-container>

        <!-- Category Description Column -->
        <ng-container matColumnDef="facilityDesc">
          <mat-header-cell *matHeaderCellDef
            >Facility Description</mat-header-cell
          >
          <mat-cell *matCellDef="let item">{{ item.facilityDesc }}</mat-cell>
        </ng-container>

        <ng-container matColumnDef="location">
          <mat-header-cell *matHeaderCellDef>Location</mat-header-cell>
          <mat-cell *matCellDef="let item">{{ item.location }}</mat-cell>
        </ng-container>

        <ng-container matColumnDef="physicalLocation">
          <mat-header-cell *matHeaderCellDef>Physical Location</mat-header-cell>
          <mat-cell *matCellDef="let item">{{
            item.physicalLocation
          }}</mat-cell>
        </ng-container>

        <ng-container matColumnDef="storeType">
          <mat-header-cell *matHeaderCellDef>Store Type</mat-header-cell>
          <mat-cell *matCellDef="let item">{{ item.storeType }}</mat-cell>
        </ng-container>
        <!-- Action Column -->
        <ng-container matColumnDef="action">
          <mat-header-cell *matHeaderCellDef>Action</mat-header-cell>
          <mat-cell *matCellDef="let item; let i = index">
            <button
              mat-icon-button
              matTooltip="Delete"
              (click)="removeRow(bufferArray.data.indexOf(item))"
            >
              <mat-icon>delete</mat-icon>
            </button>
          </mat-cell>
        </ng-container>
        <!-- Header and Row Definitions -->
        <mat-header-row
          *matHeaderRowDef="[
            'sno',
            'facilityType',
            'facilityName',
            'facilityCode',
            'facilityDesc',
            'location',
            'physicalLocation',
            'storeType',
            'action'
          ]"
        ></mat-header-row>
        <mat-row
          *matRowDef="
            let row;
            columns: [
              'sno',
              'facilityType',
              'facilityName',
              'facilityCode',
              'facilityDesc',
              'location',
              'physicalLocation',
              'storeType',
              'action'
            ]
          "
        ></mat-row>
      </mat-table>

      <!-- Pagination -->
      <mat-paginator
        [length]="bufferArray.data.length"
        [pageSize]="4"
        [pageSizeOptions]="[4, 10, 20]"
      ></mat-paginator>
    </div>
  </div>
  <div class="col-xs-12 col-sm-12 m-t-15 m-b-10">
    <button
      mat-raised-button
      color="primary"
      class="pull-left mat_blue"
      (click)="showTable(); storeAddForm.reset()"
    >
      Back
    </button>
    <button
      mat-raised-button
      color="accent"
      [disabled]="!(bufferArray.data.length > 0)"
      class="pull-right mat_green"
      (click)="saveStores(); storeAddForm.reset()"
    >
      Save
    </button>
    <button
      mat-raised-button
      color="primary"
      class="pull-right m-r-5 mat_blue"
      (click)="storeAddForm.reset()"
    >
      Clear
    </button>
  </div>
</div>
<div class="row" *ngIf="editMode">
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    <h4>
      <strong>Edit Store</strong>
    </h4>
  </div>
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 p-a-0">
    <form autocomplete="off" id="editform" #storeEditForm="ngForm">
      <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
        <mat-form-field class="hide_underline" [style.width]="'100%'">
          <input matInput style="display: none" />
          <mat-select
            required
            name="Services"
            placeholder="Serviceline"
            [disabled]="true"
            [style.width]="'100%'"
            [(ngModel)]="edit_Serviceline"
            (change)="getProviderStatesInService()"
          >
            <mat-option *ngFor="let item of services_array" [value]="item">
              {{ item.serviceName }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
        <mat-form-field class="hide_underline" [style.width]="'100%'">
          <input matInput style="display: none" />
          <mat-select
            required
            name="state"
            placeholder="State"
            [style.width]="'100%'"
            [disabled]="true"
            [(ngModel)]="edit_State"
          >
            <mat-option *ngFor="let item of states_array" [value]="item">
              {{ item.stateName }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="clearfix visible-lg"></div>

      <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
        <mat-form-field class="hide_underline" [style.width]="'100%'">
          <input matInput style="display: none" />
          <mat-select
            required
            name="facilityType"
            placeholder="Facility Type"
            [disabled]="true"
            [style.width]="'100%'"
            [(ngModel)]="edit_facilityType"
          >
            <mat-option
              *ngFor="let item of facilityType_array"
              [value]="item.facilityTypeID"
            >
              {{ item.facilityTypeName }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
        <mat-form-field [style.width]="'100%'">
          <input
            matInput
            required
            placeholder="Facility Code"
            [disabled]="true"
            appmyProviderName
            maxlength="15"
            [(ngModel)]="edit_facilityCode"
            name="facilityCode"
            #facilityTypeCode="ngModel"
          />
          <mat-hint>
            <span
              class="error_text"
              *ngIf="
                !facilityTypeCode.valid &&
                (facilityTypeCode.dirty || facilityTypeCode.touched)
              "
              >Please enter Facility Type Code</span
            >
          </mat-hint>
        </mat-form-field>
      </div>
      <div class="clearfix visible-sm"></div>
      <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
        <mat-form-field [style.width]="'100%'">
          <input
            matInput
            required
            placeholder="Facility Name"
            [disabled]="true"
            appvehicleNoSpecialCharWithCopyPaste
            [(ngModel)]="edit_facilityName"
            maxlength="100"
            name="facilityName"
            #facilityTypeName="ngModel"
          />
          <mat-hint>
            <span
              class="error_text"
              *ngIf="
                !facilityTypeName.valid &&
                (facilityTypeName.dirty || facilityTypeName.touched)
              "
              >Please enter Facility Type Name</span
            >
          </mat-hint>
        </mat-form-field>
      </div>

      <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
        <mat-form-field [style.width]="'100%'">
          <input
            matInput
            placeholder="Facility Description"
            appvehicleNoCopyPaste
            maxlength="100"
            [(ngModel)]="edit_facilityDiscription"
            name="facilityDescription"
          />
        </mat-form-field>
      </div>
      <div class="clearfix visible-lg"></div>
      <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
        <mat-form-field [style.width]="'100%'">
          <input
            matInput
            maxlength="100"
            placeholder="Location"
            appvehicleNoCopyPaste
            [(ngModel)]="edit_location"
            name="createlocation"
            #location="ngModel"
          />
          <mat-hint>
            <span
              class="error_text"
              *ngIf="!location.valid && (location.dirty || location.touched)"
              >Please enter location</span
            >
          </mat-hint>
        </mat-form-field>
      </div>
      <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
        <mat-form-field [style.width]="'100%'">
          <input
            matInput
            maxlength="100"
            placeholder="Physical Location"
            appvehicleNoCopyPaste
            [(ngModel)]="edit_physicalLocation"
            name="physicalLocation"
            #physicalLocation="ngModel"
          />
          <mat-hint>
            <span
              class="error_text"
              *ngIf="
                !physicalLocation.valid &&
                (physicalLocation.dirty || physicalLocation.touched)
              "
              >Please enter Physical Location</span
            >
          </mat-hint>
        </mat-form-field>
      </div>
      <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3 m-t-20">
        <span class="f-s-n-b">Store Type</span>
        <mat-radio-group>
          <mat-radio-button
            color="primary"
            class="p-l-10"
            [checked]="edit_mainstore"
            [disabled]="true"
            [value]="true"
            >Main Store</mat-radio-button
          >&nbsp;
          <mat-radio-button
            color="primary"
            class="p-l-10"
            [checked]="edit_substore"
            [disabled]="true"
            [value]="false"
            >Sub Store</mat-radio-button
          >
        </mat-radio-group>
      </div>
      <div class="clearfix visible-md"></div>
      <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
        <mat-form-field class="hide_underline" [style.width]="'100%'">
          <input matInput style="display: none" />
          <mat-select
            name="store"
            [required]="!edit_mainstore"
            placeholder="Main Store"
            [style.width]="'100%'"
            [(ngModel)]="edit_store"
            [disabled]="true"
          >
            <mat-option
              *ngFor="let item of storeType_arrayEdit"
              [value]="item.facilityID"
            >
              {{ item.facilityName }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </form>
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 m-t-10">
      <button
        mat-raised-button
        color="primary"
        class="pull-left mat_blue"
        (click)="showTable()"
        style="margin-top: -3%"
      >
        Back
      </button>
      <button
        *ngIf="editMode"
        mat-raised-button
        color="accent"
        style="margin-top: -5%"
        class="pull-right mat_green"
        [disabled]="storeEditForm.invalid"
        (click)="updateFacilityType(storeEditForm.value)"
      >
        Update
      </button>
    </div>
  </div>
</div>
